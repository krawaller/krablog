
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Krawaller webdev blog</title>
  <meta name="author" content="Krawaller">

  
  <meta name="description" content="Troll bait (or &#8220;How not to do it&#8221;) Here&#8217;s a blanket statement to flame against: Instantiating Backbone views/models/collections in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://krawaller.github.com/krablog/">
  <link href="/krablog/favicon.png" rel="icon">
  <link href="/krablog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/krablog/javascripts/modernizr-2.0.js"></script>
  <script src="/krablog/javascripts/ender.js"></script>
  <script src="/krablog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/krablog/atom.xml" rel="alternate" title="Krawaller webdev blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/krablog/">Krawaller webdev blog</a></h1>
  
    <h2>Musings on programming in general and JavaScript in particular</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/krablog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:krawaller.github.com/krablog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/krablog/">Blog</a></li>
  <li><a href="/krablog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/testing-backbone-objects/">Testing Backbone Objects</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-23T17:21:00+01:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Troll bait (or &#8220;How not to do it&#8221;)</h3>

<p>Here&#8217;s a blanket statement to flame against:</p>

<blockquote><p><em>Instantiating Backbone views/models/collections in order to test them is an <strong>antipattern</strong>!</em></p></blockquote>

<p>Why? When we try to test an instance, we&#8217;re faced with two main problems:</p>

<ul>
<li> It will likely <strong>require lots of setup</strong>, as we have to call the constructor with some reasonable data.</li>
<li> When testing some aspect of the instance, it is <strong>hard to make the test independent</strong> of other functionality aspects.</li>
</ul>


<h3>How to do it</h3>

<p>So, then, how should it be done? Here&#8217;s the approach I use when testing a method on a Backbone object:</p>

<ol>
<li>First we must of course <strong>analyse what the method actually does</strong> (or is supposed to do, if we&#8217;re doing true BDD and writing the tests first).</li>
<li>Start the test by <strong>storing the method</strong> to test by stealing it from the constructor prototype.</li>
<li>If the method touches <code>this</code> (which is almost always the case in a Backbone object) I <strong>create a custom context</strong> object containing stubs, spies and dummy data as needed.</li>
<li>I create eventual <strong>parameter</strong> data.</li>
<li>I&#8217;ll then <strong>call the method on the custom context</strong>.</li>
<li>Following that I can <strong>test the result</strong>&#8230;</li>
<li>&#8230;check that the <strong>context was manipulated</strong> in the expected way&#8230;</li>
<li>&#8230;and also if my <strong>spies where called in the correct way</strong>.</li>
</ol>


<h3>A small case study</h3>

<p>As an example, consider the (adapted) following view that a student of mine had in a recent project:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">AddRecipeView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DishModel</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</span><span class='line'>      <span class="c1">// Listen to model validation errors</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;invalid&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderErrors</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkErrorField</span><span class="p">)</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...rest of functionality edited out...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using the test philosophy outlined above, how would we test the <code>initialize</code> function? Here&#8217;s one suggestion, using <a href="[http://pivotal.github.com/jasmine/]">Jasmine</a>, <a href="[http://sinonjs.org/]">Sinon</a> and <a href="[https://github.com/froots/jasmine-sinon]">Jasmine-sinon</a> custom matchers.</p>

<h4>1: Analysis</h4>

<p>First we analyse what the method is supposed to do:</p>

<ul>
<li> It adds a Dishmodel instance to the context</li>
<li> It calls the render function</li>
<li> It sets two event listeners</li>
</ul>


<h4>2: Access the method</h4>

<p>We start the testcode by capturing the method to test from the constructor prototype:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">initialize</span> <span class="o">=</span> <span class="nx">AddRecipeView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>3: Context</h4>

<p>We need to create a context with stubs for <code>listenTo</code> and <code>render</code>. As the method uses a chaining syntax, we must also have these stubs return our custom context. Finally we need to have some dummy data in <code>.renderErrors</code> and <code>.checkErrorField</code>, in order to be able to test if those properties were passed to <code>listenTo</code>. Here&#8217;s the full fake context:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">listenTo</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">(</span><span class="nx">context</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">render</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">(</span><span class="nx">context</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">renderErrors</span><span class="o">:</span> <span class="s2">&quot;RENDERFUNC&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">checkErrorField</span><span class="o">:</span> <span class="s2">&quot;CHECKSTUFF&quot;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h4>4: Parameter data</h4>

<p>The initialize method doesn&#8217;t take any arguments, so we don&#8217;t need to decide on any data for that.</p>

<h4>5: Execute the method</h4>

<p>Now we execute the method on our fake context:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>6: Test the result</h4>

<p>As the initialize method isn&#8217;t supposed to return anything, we don&#8217;t need to test the result.</p>

<h4>7: Check context manipulation</h4>

<p>The method was supposed to add a dishmodel instance to the <code>.model</code> property, so let&#8217;s make sure that happened:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should set a Dishmodel instance on .model&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">model</span> <span class="k">instanceof</span> <span class="nx">Dishmodel</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>8: Check method calls</h4>

<p>Finally we need to make sure that other functions were called as expected. First we check for the expected call to <code>render</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should call render&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">render</span><span class="p">).</span><span class="nx">toHaveBeenCalledOnce</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>And finally we test if the two event listeners were set:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;added the event listeners&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">).</span><span class="nx">toHaveBeenCalledTwice</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">.</span><span class="nx">firstCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span><span class="nx">context</span><span class="p">.</span><span class="nx">renderErrors</span>
</span><span class='line'>    <span class="p">]);</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">.</span><span class="nx">secondCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="nx">context</span><span class="p">.</span><span class="nx">checkErrorField</span>
</span><span class='line'>    <span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>End result</h4>

<p>To save you scrolling back and forth, here&#8217;s the <code>initialize</code> source again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">AddRecipeView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DishModel</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</span><span class='line'>      <span class="c1">// Listen to model validation errors</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;invalid&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderErrors</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkErrorField</span><span class="p">)</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...rest of functionality edited out...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8230;and here&#8217;s the test code in full:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;the initialize function&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">initialize</span> <span class="o">=</span> <span class="nx">AddRecipeView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">listenTo</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">(</span><span class="nx">context</span><span class="p">),</span>
</span><span class='line'>            <span class="nx">render</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">(</span><span class="nx">context</span><span class="p">),</span>
</span><span class='line'>            <span class="nx">renderErrors</span><span class="o">:</span> <span class="s2">&quot;RENDERFUNC&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">checkErrorField</span><span class="o">:</span> <span class="s2">&quot;CHECKSTUFF&quot;</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="nx">initialize</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should set a Dishmodel instance on .model&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">model</span> <span class="k">instanceof</span> <span class="nx">Dishmodel</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should call render&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">render</span><span class="p">).</span><span class="nx">toHaveBeenCalledOnce</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;called listenTo correctly&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">).</span><span class="nx">toHaveBeenCalledTwice</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">.</span><span class="nx">firstCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span><span class="nx">context</span><span class="p">.</span><span class="nx">renderErrors</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">.</span><span class="nx">secondCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="nx">context</span><span class="p">.</span><span class="nx">checkErrorField</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>All tests control one specific expected behaviour of the method, and nothing else. We&#8217;re not even depending on any Backbone functionality, which is one of the badges to strive for when unit testing your Backbone apps! Achieving that will make the test simpler, smaller and less fragile.</p>

<h3>Case study #2 - Testing DOM methods</h3>

<p>The same approach can be adopted even when DOM manipulation is involved. Here is the <code>renderErrors</code> method of the same view:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">AddRecipeView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...other functionality edited out...</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">renderErrors</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.errors&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">validationError</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.errors&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// ...other functionality edited out...</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>How to test that? There&#8217;s even quirkier chaining going on, and we&#8217;re manipulating the DOM. Is testing this really feasible without instantiating the view?</p>

<p>Here&#8217;s what I did, using the same approach as before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;the renderError function&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">renderErr</span> <span class="o">=</span> <span class="nx">AddRecipeView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderErrors</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">model</span> <span class="o">=</span> <span class="p">{</span><span class="nx">validationError</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>          <span class="p">{</span><span class="nx">message</span><span class="o">:</span><span class="s2">&quot;err1&quot;</span><span class="p">},{</span><span class="nx">message</span><span class="o">:</span><span class="s2">&quot;err2&quot;</span><span class="p">},{</span><span class="nx">message</span><span class="o">:</span><span class="s2">&quot;err3&quot;</span><span class="p">}</span>
</span><span class='line'>        <span class="p">]},</span>
</span><span class='line'>        <span class="nx">$el</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">html</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">(),</span>
</span><span class='line'>            <span class="nx">append</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">spy</span><span class="p">()</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">$</span><span class="o">:</span> <span class="nx">sinon</span><span class="p">.</span><span class="nx">stub</span><span class="p">().</span><span class="nx">returns</span><span class="p">(</span><span class="nx">$el</span><span class="p">);</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="nx">renderErr</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span><span class="nx">model</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should use the correct selector&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">$</span><span class="p">).</span><span class="nx">toHaveBeenAlwaysCalledWith</span><span class="p">(</span><span class="s2">&quot;.errors&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;should have cleared the previous html&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;appends each errormsg&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">).</span><span class="nx">toHaveBeenCalledThrice</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">.</span><span class="nx">firstCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>          <span class="nx">model</span><span class="p">.</span><span class="nx">validationError</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">message</span><span class="o">+</span><span class="s2">&quot;&lt;br&gt;&quot;</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">.</span><span class="nx">secondCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>          <span class="nx">model</span><span class="p">.</span><span class="nx">validationError</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">message</span><span class="o">+</span><span class="s2">&quot;&lt;br&gt;&quot;</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">.</span><span class="nx">thirdCall</span><span class="p">.</span><span class="nx">args</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span>
</span><span class='line'>          <span class="nx">model</span><span class="p">.</span><span class="nx">validationError</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">message</span><span class="o">+</span><span class="s2">&quot;&lt;br&gt;&quot;</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to deal with the chain, I made a dummy object for the element (<code>$el</code>), and then I made the spy for the scoped selector <code>$</code> return that dummy. This deals with the chaining problem, but is perhaps a bit too implementation specific - for example, the student might change from using <code>this.$(selector)</code> to <code>this.$el.find(selector)</code>, in which case my test would fail. It will however keep working even if he starts caching the result from <code>this.$(selector)</code>, which he should of course do.</p>

<p>Apart from the danger of becoming implementation specific, I find that this fake chain approach mostly works very well!</p>

<p>As for the DOM, the secret to testing it is NOT to test it. Here I stub out the relevant methods, and then simply check that they&#8217;re called correctly. No special measure needs to be taken just because they&#8217;re functions that are supposed to affect the DOM. I find this approach much easier than actually making sure that the correct html was set. In fact, I&#8217;ll go as far as to end this post with another bit of troll bait:</p>

<blockquote><p><em>Testing if <code>this.$el.html() === expectedHtml</code> is an <strong>antipattern</strong>!</em></p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/slides-form-sfis-talk-october-2012/">Slides Form SFIS Talk October 2012</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-01T00:00:00+01:00" pubdate data-updated="true">Nov 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Thanks to all who attended, it was a great time! Here be a link to the slides: <a href="http://bit.ly/sfis2012">http://bit.ly/sfis2012</a></p>
<p>&#8230;and here&#8217;s a powerpoint version:&nbsp;<a href="http://bit.ly/TXQNBI">http://bit.ly/TXQNBI</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/software-passion/">Software Passion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-25T00:00:00+01:00" pubdate data-updated="true">Mar 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this week, Jacob and I participated in the <a href="http://softwarepassion.se/">Software Passion Conference</a> in Gothenburg. Heaps of fun! It was great to take part in a conference that wasn&#8217;t all about the web, but programming in general. I find I tend to &#8220;stare into my navel&#8221; quite a bit, caring nothing about the world outside of JavaScript. So this was a great way to broaden my horizons!</p>
<p>Jacob held a lecture on <a href="http://kraniumjs.com/">Kranium</a>, his webifying framework for Titanium. If you want his slides, get in touch with him directly (twitterhandle @litenjacob), or wait for me to get him to post them here (but don&#8217;t hold your breath).</p>
<p>I spoke on CoffeeScript, slides are right here:</p>
<p>[[posterous-content:jGtlutziHEHjExmjavEu]]</p>
<p>All in all a great experience, thanx to all who turned up for our sessions! Special thanks to mr Crockford, who gave his blessing afterwards. I&#8217;ll be smiling from ear to ear for weeks! :)</p>
<p>Hah&#8230; Jacob here. Here are my slides. Take that, brother! :-)</p>
<p>[[posterous-content:fxrsFkpiyGFAhCasibtr]]Unfortunately, the embedded videos are missing. However, you could have a look at a recording of my session at <a href="http://vimeo.com/30391192">CodeStrong</a>&nbsp;which is based on the same slides.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/coffeescript-overview-and-resource-inventory/">CoffeeScript Overview and Resource Inventory</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-04T00:00:00+01:00" pubdate data-updated="true">Nov 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">An overview of CoffeeScript and good learning resources</div>
<p>As I&#8217;ve <a href="http://blog.krawaller.se/tag/ria_university_course">written about previously</a> (although far from as much as I hoped to), I&#8217;m teaching a course at&nbsp;Linnaeus University&nbsp;on Advanced JavaScript for RIA creation. In the course, parallell to creating a RIA, the students are also tasked with doing a deepdive into&nbsp;a related subject of their own choosing (most often on a technology employed in the RIA creation).</p>
<p>Because I&#8217;m still working my way to a 3rd year degree myself, I ended up in the weird situation of getting to take my own course! Although not giving myself a grade, unfortunately. I made my deepdive in CoffeeScript, which I thought might also be fit for the Krawaller blog.</p>
<p>So here it is: a repost from my student alter ego, an overview of CoffeeScript:</p>
<p>&nbsp;</p>
<ol> </ol>
<h2>What is CoffeeScript?</h2>
<p>Briefly explained, CoffeeScript is a thin syntactical layer on top of JavaScript. You write CoffeeScript, it compiles to JavaScript, which is then run in the browser (or Node, or wherever) in the usual way.</p>
<p>As has been widely realised the last few years, JavaScript is a most excellent language when wielded right, utilizing its expressiveness and applying functional programming.</p>
<p>However, the syntax is far from as elegant as the underlying language. We all know the story of how Brendan Eich, JavaScript&#8217;s creator, was forced to make it &#8220;look like Java&#8221;. Had he not been wearing that shackle at the time (and not had the very short timespan to work with), JavaScript would have been looking very differently, and there likely would be no need for CoffeeScript.</p>
<p>But this, in essence, is the problem space that CoffeeScript tries to solve: it aims to negate the clunky syntax, exposing the beautiful language beneath. It does this by:</p>
<ul>
<li>&#8230;using <strong>significant whitespace</strong>. We&#8217;re already indenting our code, so why should we also have to enclose a function body in curly braces? In CoffeeScript, we can declare objects and function, and use controlstructures such as if or switch, with just whitespace to signify the depth.</li>
<li>&#8230;<strong>cleaning the syntax</strong>. By sacrificing the (unnecessary) ability to have many statements on a single line, we negate the need for semicolons completely. CoffeeScript also strives to be more readable, by changing existing keywords and operators to more succinct and self-explanatory versions. Thus &#8220;function&#8221; is distilled down to the simple dash rocket &#8220;-&gt;&#8221;, equality is &#8220;is&#8221; instead of &#8220;===&#8221;, etc.</li>
<li>&#8230;adding <strong>new keywords</strong>&nbsp;to simplify commonly occuring patterns. This includes class declaration, prototype access, destructuring assignments, loops, and many more. Users of Ruby or Lisp will recognize much of this. These concepts are a very powerful way of shortening your code, and the reason that CoffeeScript code is almost always half or less of the size of the generated JavaScript.</li>
</ul>
<p>For actual examples, there is a long list of learning and demonstrating resources in the how section. If you&#8217;re eager to see it right now, take a quick look at the&nbsp;<a href="http://coffeescript.org/">official homepage</a>.</p>
<p>So, underneath it all, it&#8217;s the same old JavaScript. One of the creator&#8217;s, Jeremy Ashkenas, goals was for there to always be a 1 to 1 correspondence with JavaScript and CoffeeScript. This makes it easy for someone already into JavaScript to adopt CoffeeScript and sharpen his game. It also means that your CoffeeScript can be used with any and all JavaScript library, and that you can use all JavaScript libraries in your CoffeeScript. In fact, CoffeeScript and jQuery makes for a very sexy combination, as <a href="http://buhrmi.tumblr.com/post/5371876452/how-coffeescript-makes-jquery-more-fun-than-ever">this article</a> notes.</p>
<p>&nbsp;</p>
<h2>Why (not) use CoffeeScript?</h2>
<p>There are two main advantages to CoffeeScript:</p>
<ul>
<li>The code is<strong> more readable</strong>. This is not a trivial thing - being able to glance through someone&#8217;s code and deduce what it does is a very commonly occuring task, and CoffeeScript will at times read almost as pseudo code, clearly communicating the intent.&nbsp;</li>
<li>The code is <strong>shorter</strong>. This, too, will of course contribute to readability. Not just by taxing less patience - the extra lines that you don&#8217;t have to write in CoffeeScript are commonly rather abstract and thus hard to decipher, such as loop juggling, inheritance gymnastics, etc.</li>
<li>A third, inofficial advantage, significant to my proud self, is that you <strong>feel smarter</strong> when using it. Being able to more with less was always the badge of the ninja, and CoffeeScript opens up even more ways of accomplishing that (and more ways to abuse it, of course&#8230;).</li>
</ul>
<p>Lets now instead touch on the more interesting subject of why <strong>not</strong> to use it!</p>
<ul>
<li>It requires <strong>new tools</strong>. This isn&#8217;t necessarily a big problem, as many of the popular editors out there have plugins for CoffeeScript already. But finding and installing that plugin is a hoop you have to jump through, and if you&#8217;re not using one of the editors with a plugin available, you have to invest the time to learn a new editor (which you probably should be doing anyway, as you&#8217;re likely using an editor without a plugin API).&nbsp;</li>
<li>It introduced a <strong>new step in the build process</strong>, as the code has to be compiled to JavaScript before it is used (at least for now, see the last bullet below). This is pretty trivial once you set it up to autocompile whenever the CoffeeScript file is saved, but that initial setup still has to be done.</li>
<li>It is a <strong>threshold in any collaboration project</strong>, which most projects are. Even though, for an experienced JavaScript programmer, grokking CoffeeScript can be done in a few hours, it is a few hours that every non-CoffeeScript developer has to invest before he or she can contribute to the code. This will have a serious impact on the amount of people ending up actually contributing.&nbsp;</li>
<li>For runtime errors, you&#8217;ll get <strong>linenumbers referencing the generated JavaScript</strong>. Mostly you&#8217;ll immediately know where in the CoffeeScript code the bug is located, but when you don&#8217;t it is a real drag: you have to open the generated file, find the line, deduce from the context what CoffeeScript function this correlates to, then find that corresponding section in the CoffeeScript file and fix the error. There are projects in the work to mitigate this (CoffeeScript execution is coming to Firefox, and already present in Rails), but at the time of writing it remains a very real problem.</li>
</ul>
<p>Whether the pros outweigh the cons is of course heavily situational, depending both on the individuals and the project.&nbsp;</p>
<p>&nbsp;</p>
<ul>
</ul>
<h2>Who is CoffeeScript for?</h2>
<p>To me, the answer to this question is very short: it is for <strong>someone who already knows JavaScript</strong>, and preferrably knows it rather well. Two reasons for this:</p>
<ol>
<li>If you only know CoffeeScript but not JavaScript (although obviously knowledge in one will spill over to the other), you are very limited in finding use for your services.</li>
<li>Someone who is already well versed in JavaScript is also equally familiar with its downsides. He or she will therefore understand the point of CoffeeScript, and be able to use its strengths even better.</li>
</ol>
<p>If you&#8217;re looking to get into web development, CoffeeScript (in my humble opinion) is not a good place to start. Learn JavaScript the traditional way, and when you know it well enough to be annoyed by the verbose syntax (and have thought through the pros &amp; cons above), adopt CoffeeScript!</p>
<p>&nbsp;</p>
<p><span style="font-size: 20px; font-weight: bold;">How is CoffeeScript used?</span></p>
<p>The primary resource for learning CoffeeScript is definitely the excellent&nbsp;<a href="http://jashkenas.github.com/coffee-script/">official homepage</a>, which is a testimony to good web design. Apart from a very accessible documentation it also has an interactive console, where you can type CoffeeScript code, see the generated JavaScript in real time, and execute it to see the result. The code examples in the documentation uses the same functionality, enabling you to toy around with it for easy understanding.</p>
<p>That said, there are several other good resources for learning CoffeeScript. I&#8217;ve done an inventory below, split into various categories depending on their media.</p>
<h3>Books</h3>
<h3><span style="font-size: 13px; font-weight: normal;">First and foremost we have&nbsp;</span><a href="http://coffeescript-book.com/" style="font-size: 13px; font-weight: normal;">CoffeeScript - accelerated JavaScript development</a><span style="font-size: 13px; font-weight: normal;">&nbsp;by Trevor Burnham was my foremost resource when learning the language. It is published by Pragmatic Programmers, available as both paper book and ebook. Normally, when a book is published on something that has just recently been made available (or, as in CoffeeScript&#8217;s case, reached critical popularity mass), you&#8217;d expect a greedy rush-job. This is not the case here, and it is evident that Trevor has lovingly crafted the book over a length of time. The book assumes previous familiarity with JavaScript, and so focuses on CoffeeScript&#8217;s additions.</span></h3>
<p><span style="font-size: 13px; font-weight: normal;">One of my favourite JavaScript books for beginners is the free online book&nbsp;</span><a href="http://eloquentjavascript.net/">Eloquent JavaScript</a>&nbsp;by Marijn Haverbeke (recently also made available in an edited&nbsp;<a href="http://www.amazon.com/Eloquent-JavaScript-Marijn-Haverbeke/dp/1593272820">paper&nbsp;version</a>). He made this available to the public domain, which enabled E. Hoigaard to &#8220;port&#8221; the book to CoffeeScript, resulting in&nbsp;<a href="http://autotelicum.github.com/Smooth-CoffeeScript/">Smooth CoffeeScript</a>. His book retains the charm and razor-sharp teaching skills from its predecessor, successfully translated to CoffeeScript&#8217;s concepts. Do note, however, that both books also teach basic programming at the same time, so Smooth CoffeeScript is not just a dedicated syntax-learning resource.</p>
<p>The two now mentioned books stand apart in regards to scope and author-spent time, but there are a few more books I&#8217;d like to mention. First off we have <a href="http://arcturo.com/library/coffeescript/">Little book on CoffeeScript</a>&nbsp;by Alex MacCaw. It is not as meaty as the others, but very succinct and to-the-point. He also employs a very neat function where, for all CoffeScript code examples, you can see the corresponding JavaScript (by clicking the small grey square in the top-right corner). Alex also adopts the neat new trend of housing the book&#8217;s code at Github, enabling readers to quickly make pull requests to fix errata.</p>
<p>Finally we have the community-driven&nbsp;<a href="http://coffeescriptcookbook.com/">CoffeeScript Cookbook</a>, also on Github. As the title implies it is not a narrative book as such, but a recipe collection of CoffeeScript snippets. However it is still worth checking out, and I really like the collaboration initiative (although so far, my contribution is limited to removing a few unnecessary invocation parens).</p>
<h3>Screencasts</h3>
<p>I cannot not have the <a href="http://peepcode.com/products/coffeescript">Peepcode CoffeeScript screencast</a>&nbsp;on top here. It is a commercial product ($12), but well worth the price. Sometimes, with professionally created teaching products, I find that the money is spent more on superficial production values than anything else, but this is not the case here - although it is a very polished product, it is evident that it is also very well though-ought, and that a lot of testing and planning has foregone the recording. Heartily recommended! You&#8217;ll also learn some Jasmine unit testing at the same time, just for good measures! There are some&nbsp;teasers on their supporting&nbsp;<a href="http://peepcode.com/blog/2011/coffeescript-in-motion">blog post</a>&nbsp;(which is also well worth reading).</p>
<p>There is a really good&nbsp;<a href="http://screencasts.org/episodes/introduction-to-coffeescript">introduction to CoffeeScript</a>&nbsp;18-minute video at <a href="http://screencasts.org">screencasts.org</a>&nbsp;(who also have a lot of other high-quality web-related content). Extensive transcript is included, which is something I appreciate. The title is apt, meaning it is an introduction and not a full coverage, but as a starting point it serves it&#8217;s purpose very well, and it does manage to touch on mostly all important concepts.</p>
<p>If you (like many CoffeeScript adopters) come from a Rails background, there is a good 11-minute episode on <a href="http://railscasts.com/">Railscast</a> about <a href="http://railscasts.com/episodes/267-coffeescript-basics">CoffeeScript basics</a>. Rails knowledge is not mandatory, though, as the video focuses on a walkthrough of a conversion of a JavaScript code to CoffeeScript, explaining the concepts in the process. There are some extensive written-out shownotes <a href="http://asciicasts.com/episodes/267-coffeescript-basics">here</a>. The video gets extra credits from me for the hands-on approach - the teaching while translating concept works really well!</p>
<p>Charles MaxWood at&nbsp;<a href="http://teachmetocode.com/">TeachMeToCode</a> has done an episode called <a href="http://teachmetocode.com/screencasts/coffeescript-basics-a-teach-me-to-code-tutorial/">CoffeeScript basics</a>, which is a nice, slow-paced walk through how to get started. If you don&#8217;t want to download the video, it is also available on youtube <a href="http://www.youtube.com/watch?v=fvsKkwbhfs8">here</a>. As the other TMTC videos, it is done in a &#8220;live&#8221; setting where we see Charles hacking away in the editor. The style is not for all, but for someone who is dipping their first toe into the coffee and want to hear the thoughts of someone else doing the same thing, it is spot on.</p>
<p>The same guys later followed up with another CoffeeScript episode called <a href="http://teachmetocode.com/screencasts/coffeescript-the-cool-parts/">CoffeeScript - the Cool Parts</a>, which is more or less a continuation of the first video. It is done in exactly the same style, but moves on to the more advanced concepts (mainly inheritance). This episode is <a href="http://www.youtube.com/watch?v=43P0kWswWWI">available on youtube too</a>.</p>
<h3>Tutorials</h3>
<p>If you prefer to do your learning through more static means, here follows a few articles on CoffeeScript. First out is the&nbsp;<a href="http://net.tutsplus.com/tutorials/javascript-ajax/rocking-out-with-coffeescript/">Rocking out with CoffeeScript</a>&nbsp;on the <a href="http://net.tutsplus.com/">net</a> section (well worth exploring) of <a href="http://tutsplus.com/">tutsplus</a>. It is from late 2010, so there are a few things missing (classes). Still, CoffeeScript has been very stable since then, so what&#8217;s there is all up to date. The article is also very well written - assuming no prior knowledge, it immediately gives you a context, a pro-con discussion, and then delves into the details to be put into that context. Well done.</p>
<p>Stefan Buhrmeister wrote a short but sweet piece on <a href="http://buhrmi.tumblr.com/post/5371876452/how-coffeescript-makes-jquery-more-fun-than-ever">How CoffeeScript makes jQuery more fun than ever</a>. It is a pretty &#8220;standard&#8221; CoffeeScript quicklook, but also making the point of how integrating JavaScript libraries such as jQuery is no problem. He also manages to highlight how CoffeeScript makes some aspects of jQuery (iterations, callbacks) just plain beautiful.&nbsp;</p>
<p><a href="http://elegantcode.com/">ElegantCode</a> has a nice tutorial series by Jan Van Ryswyck titled&nbsp;<a href="http://elegantcode.com/2011/06/21/exploring-coffeescript-part-1-and-then-there-was-coffee/">Exploring CoffeeScript</a>. They start at the very beginning with installing it, and then holds your hand through getting over the initial threshold. Be sure not to miss the later installments, as they are not linked from the first post!&nbsp;</p>
<p>For a quick overview, there is a neat article on <a href="http://javascriptatoms.com/">JavaScriptAtoms</a> called <a href="http://javascriptatoms.com/2011/05/coffeescript-the-other-javascript/">CoffeeScript - the other JavaScript</a>. It&#8217;s not a language primer, but gives you the context and an idea on what CoffeeScript is all about.</p>
<h3>Slides</h3>
<p>I&#8217;m not a fan of digesting slides without the accompanying talk, but I&#8217;ve found a couple that can stand somewhat well on their own legs, if you want a lightning-fast powerpointy CoffeeScript fix. First off we have <a href="http://yobriefca.se/blog/2011/10/10/coffeescript-the-awesome-talk/">CoffeeScript the Awesome</a>&nbsp;by James Hughes, which quickly walks through the various syntactic sugars by peppering you with bi-JavaScript-CoffeeScript code examples. James finishes up by offering some tips for using CoffeeScript in a .NET environment.</p>
<p>Jacques Crocker made a <a href="http://coffeescript-seattlejs.heroku.com/#1">really neat in-browser presentation</a> for SeattleJS (navigate using the arrow keys). Again we see the various features demonstrated through code examples, but they are well chosen and crafted, and you very quickly get a feel for the language. Also, the programming behind the presentation itself is pretty impressive.</p>
<h3>Twitter</h3>
<p>If found it useful to follow the following two Twitter accounts. First off <a href="http://twitter.com/#!/coffeescript">@CoffeeScript</a>, which is the official account. It is run by Trevor Burnham, author of the book. He is really fast at replying, and - needless to say - knows what he is talking about, so this feed is a great resource when you get stumped while coding. Of course, it is also a good way to keep up to date with what&#8217;s going on in the CoffeeScript world.</p>
<p>Another good resource for that is <a href="http://twitter.com/#!/coffeescript_m8">@CoffeeScript_m8</a>. They are very quick to pick up and tweetlink to new CoffeeScript-related content popping up, and indeed claim that &#8220;Follow us, and you won&#8217;t miss a thing about CoffeeScript!&#8221;.</p>
<h3>Communities</h3>
<p>On&nbsp;<a href="http://stackoverflow.com/">StackOverflow</a>, putting the <a href="http://stackoverflow.com/questions/tagged/coffeescript">CoffeScript tag</a> on your question will quickly give you a slew of answers. Trevor Burnham is pretty active here too, and in general the responses given seem to be of very high quality.</p>
<p>There are also quite a lot of interesting related content on the <a href="http://www.quora.com/CoffeeScript">CoffeeScript section</a> of <a href="http://www.quora.com/CoffeeScript">Quora.com</a>. Unlike StackOverflow this is not a place for help with code matters, but deals more with higher level discussion. Thus you&#8217;ll find questions like &#8220;what are the disadvantages of using coffeescript&#8221;, &#8220;what kinds of programmer are more likely to use coffeescript over javascript&#8221;, etc.</p>
<p>You&#8217;ll also find quite a bit of life in the <a href="https://groups.google.com/forum/#!forum/coffeescript">CoffeeScript google group</a>, both troubleshooting and news relays.&nbsp;</p>
<h3>Other resources</h3>
<p>As stated initially, the official homepage is the best and quickest way if you just want to try your hand at some CoffeeScript hacking. However, if you&#8217;re using the excellent <a href="http://jsfiddle.net/">JSFiddle</a>, it might be good to know that they have added CoffeeScript support (albeight a bit hidden: open the Panels panel and change JavaScript to CoffeScript in the dropdown). As JSFiddle can persist code this is a good way of sharing CoffeeScript snippets, if you don&#8217;t want to create a github gist.</p>
<p>The <a href="http://ace.ajax.org/">web-based Ace editor</a> (formerly Bespin) also has syntax highlighting for CoffeeScript.</p>
<p>If you&#8217;re using Firefox and Firebug, you&#8217;d do well to check out the&nbsp;<a href="https://addons.mozilla.org/en-US/firefox/addon/acebug/">Acebug addon</a>. Among other things, it gives you CoffeeScript straight in the console!</p>
<p>There is an excellent&nbsp;<a href="https://github.com/jashkenas/coffee-script-tmbundle">CoffeeScript bundle</a> available for the TextMate editor, maintained by mr Ashkenas himself. If you&#8217;re using TextMate, picking this up is a no-brainer. You get syntax highlighting, a runtime environment, and can quickly inspect the generated JavaScript. For plugins to other editors, see the <a href="https://github.com/jashkenas/coffee-script/wiki/Text-editor-plugins">list in the wiki</a> of the official coffeescript page.</p>
<p>While not a learning resource, the <a href="http://coffeekup.org/">CoffeeKup project</a>&nbsp;(also see readme file <a href="https://github.com/mauricemach/coffeekup#readme">here</a>) is well worth checking out; It lets you declare your markup in CoffeeScript! Sounds weird, and it is, but it is surprisingly elegant, and it lets you do content and behaviour with one single language. There has been similar attempts in JavaScript, but due to the verboseness of that language, the result was always even clunkier than html. Now, with CoffeeScript, the idea works!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/krawaller-real-life-appearances/">Krawaller Real-life Appearances</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-27T00:00:00+02:00" pubdate data-updated="true">Oct 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">A summary of Krawaller&#8217;s public appearances over the autumn.</div>
<p>First and foremost, Jacob attended Appcelerator&#8217;s <a href="http://www.appcelerator.com/showcase/videos/codestrong2011/">CodeStrong conference</a>. He promised a blogpost about that, but I&#8217;m not holding my breath! At the conference, Jacob gave a talk about <a href="http://kraniumjs.com/">Kranium</a>, Krawaller&#8217;s new utility library for Titanium development. The video is available <a href="http://player.vimeo.com/video/30391192?title=0&amp;byline=0&amp;portrait=0&amp;color=9a0707&amp;autoplay=1">here</a>. He promised a blogpost about Kranium too!</p>
<p>Together with good friends Alexander and Nicklas, we participated in <a href="http://travelhack.se">Travelhack</a> - a most excellent hackaton in Gothenburg focusing mainly around commuting. It was a brilliant event, fun and engaging! You can watch a video where all teams present their doings <a href="bambuser.com/v/2030502">here</a> (we come on at about 1:20).</p>
<p>Finally I gave a speech at SFIS (loosely translated as Swedish Society for Information Specialists), who had a day on mobile technology. I talked about mobile app development. The slides (in Swedish) are available at 280 Slides <a href="http://bit.ly/sfis2011">here</a>, or for those of you who use a pretend browser (IE), the individual pictures are attached in the gallery below.</p>
<p>[[posterous-content:xvbyAlkhilqvphlaGwEj]]</p>
<p>Here&#8217;s a Swedish PS for the librarians who were in the audience at SFIS: Jacob, den andra h&auml;lften av Krawaller, har lekt med en prototyp f&ouml;r en bokutl&aring;ningsapp, vilket jag givetvis borde haft vett att skvallra om f&ouml;r er! Ni kan se en film av den <a href="http://t.co/MJUrM4dy">h&auml;r</a>.&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/titanium-app-for-explaining-layout-mechanisms/">Titanium App for Explaining Layout Mechanisms</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-04T00:00:00+02:00" pubdate data-updated="true">Aug 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">Wrapping our brains around Titanium View layouts!</div>
<p>During a recent app project, I felt constantly hampered by not having a strong enough ninjutsu understanding of laying out things in a Titanium app. How does horizontal and vertical layout actually work? What&#8217;s the difference between a View, a ScrollView and a ScrollableView? When having too much content to show on screen, do I want the parent or child to scroll? What happens when I have a scrolling child in a scrolling parent?</p>
<p>I constantly had to pause my work to peruse the Titanium docs/kitchensink/sourcecode, or (more often) do some experimenting on the side, regarding stuff that I suspected I really should have nailed down. It felt like doing maths without having memorized the multiplication tables!&nbsp;</p>
<h3>The TiView app</h3>
<p>Eventually the added-up frustration got too great, so I set aside some time for grokking and getting comfortable with the API. This resulted in a small Titanium application we call <strong>TiView</strong>. It has a number of demos, showing on screen what various layout properties will actually result in. Most of it probably already obvious to most of you out there, but I felt it helped me to &#8220;say it out loud&#8221; in this way.</p>
<p>As stated the app is very simple. It has a number of demos, ordered into categories. The screenshot below shows the current content, I hope to add some more to it before I move on too far:&nbsp;</p>
<p>[[posterous-content:frowHAoziJDnxttahjCg]]Each category then consists of a ScrollableView, where each view is a demo of some layout code. The properties used are displayed inside the laid-out child:</p>
<p>[[posterous-content:ufiCtpiiqrnHFAacpcgH]]</p>
<p>The source code is available in the Git repo <a href="http://github.com/krawaller/tiview" title="TiView git repo" target="_blank">here</a>. Have a snoop and see if might be of any help. Or even better, add more demos of your own! It&#8217;s just 250 lines in a single file, and all the demos are just object literals sent into a constructor function, so getting your own ideas in there shouldn&#8217;t require that strong a shoe-horn:</p>
<script src="https://gist.github.com/1125138.js?file=gistfile1.js"></script>
<h3>Android VS iPhone</h3>
<p>When we ran the app on an Android, it turned out that there where even more difference in behaviour between the platforms that we had originally thought! Therefore we gave the demos platform-specific descriptions.</p>
<p>This process was hugely informative for us - not only did we gain a better understanding of the layout API:s, but also of the (many) differences between the platforms! Having a good map of these differences will make it much easier to write code that won&#8217;t behave differently on the other platform.</p>
<p>So we encourage you to try out TiView, and hope it will be of use!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/krawallers-ipad-design-flow-productivity-app/">Krawaller&#8217;s iPad Design Flow - Productivity App Recommendations</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-26T00:00:00+01:00" pubdate data-updated="true">Mar 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">Reviewing our favourite iPad productivity apps!</div>
<p>While waiting for my younger brother to post some long-promised content, I thought I&#8217;d give a quick overview of our design flow iPad usage. When I first got my pad, I bought it mainly as a testing device, not really anticipating to use it as an actual productivity tool. Because let&#8217;s face it, in what fields could it possibly bester my trusted MacBook Pro?&nbsp;</p>
<p>In quite a few, as it turned out! Obvious as it might be to the rest of the world, a touch screen is a very different input device compared to a touchpad and keyboard. And, as I eventually realised, it is especially well suited for sketching and doing mockups.&nbsp;</p>
<h2>Our design process</h2>
<p>We&#8217;ve always done quite a bit of planning before we got our hands dirty in the editors. This planning can take many different forms; napkin scribbles, phone conversations, whiteboard doodling, and sometimes an actual UML diagram.&nbsp;</p>
<p>This initial sketching would cover all aspects of the application-to-be: program flow, data structures, use cases, and UI layout. Mostly we&#8217;d go through several iterations, and only when things began to settle down a bit did we fire up the editors.&nbsp;</p>
<p>This flow remains the same, but what the iPad has allowed us to do is to digitize the first part. Doing those things on the computer was never an option; it&#8217;s simply too slow! There are plenty of good mindmap/diagram/software-planning programs for MacOS, but none that can keep up with the speed of thought.&nbsp;</p>
<p>On the iOS, it turned out, it&#8217;s a different story, all thanx to the touchpad. Using this input device, you can sketch and mock-up almost as fast as you can think it!&nbsp;</p>
<p>We never thought of our disorganized doodling as consisting of different sketching paradigms such as mindmapping, flowcharting, etc. It was all something inbetween, crossing haphazardly back and forth between approaches. Now, using iPad apps instead of napkins, this process has broken down into several main areas:</p>
<ul>
<li><strong>mindmapping</strong> - organizing thoughts together</li>
<li><strong>flowcharting</strong> - mapping the flow through a single interaction/function/event chain</li>
<li><strong>prototyping</strong> - mocking up user interfaces or parts thereof</li>
<li><strong>doodling</strong> - simple free-hand sketching</li>
<li><strong>codehandling</strong> - reading existing code bases</li>
<li><strong>filesharing</strong> - using cloud file handling services</li>
</ul>
<p>And here follows a quick run through our favourite tool for each of these areas!</p>
<h2>Mindmapping with iThoughts</h2>
<p>First off: mindmapping. This can be used initially just to sort app ideas together, but also in a later stage to map out the ingredients of the app: UI parts, classes, globals, etc. In essence this is our rebellious interpretation of a UML class diagram, I guess.&nbsp;</p>
<p>[[posterous-content:HcnidBeAAyybnydkaDzG]]</p>
<p>To this end, our favourite tool has come to be iThoughts HD. There are a lot of various options, of which I&#8217;ve tried most, but iThoughts somehow just resonates with me. Some favoured features are:</p>
<ul>
<li>Organisation of maps: a fundamental feature, you might think, but it is missing from a surprisingly huge number of mindmapping apps. iThoughts lets you organise maps in folders and subfolders. It is also very easy to base a map upon another, copy them, etc.</li>
<li>Excellent export options. And with excellent I mean that it supports our file handling system of choice, namely Dropbox. It can synchronize automatically to a map in the cloud, and also of course export into other formats.</li>
<li>Brilliant UI shortcuts throughout, minimizing clicks and gestures. It is very evident that the developers have invested lots of time in making the mapping process as smooth as possible.</li>
<li>Perhaps not a feature, but the maps are, with very little effort, rather beautiful! Not a factor to sneer at, and a potential client frequently reacts much better to an iThoughts-generated pdf than to our previous napkin-based charts&#8230;</li>
</ul>
<h2>Flowcharting with Instaviz</h2>
<p>When zooming in a bit at the process and planning out a user interaction (or even a specific application function), flowcharting is an excellent way to visualize your thoughts. Again there are a multitude of options of which I&#8217;ve sampled most, but the one that stuck out from the crowd is Instaviz.&nbsp;</p>
<p>[[posterous-content:uhFCsjmEhmkecdiDfusu]]</p>
<p>Instaviz boasts having an advanced layout algorithm developed over the course of decades, and this immediately shows. Not having any control of the actual layout and position of boxes takes some getting used to, but once you have it&#8217;s really convenient. The algorithm will always (so far completely without exception) find an excellent way to organize the boxes, so that the flow is easy to follow and as few connections as possible cross each other.</p>
<p>Now, there are some irks; Instaviz has no chart organisations (they&#8217;re all just lying in one huge list, meaning you have to prefix the names with project and milestone in order to navigate), and perhaps worse, there is no way to select more than one box at a time. There are a few other rough edges in the UI as well, such as having to delete the default text in a label, etc.&nbsp;</p>
<p>But even so the good outweigh the bad, and the app is still in development so it will only get better from here. Heartily recommended!</p>
<h2>UI prototyping with Omnigraffle</h2>
<p>For laying out the user interface, I&#8217;ve fallen in love with Omnigraffle. In comparison its a hugely expensive piece of software, but in essence you get what you pay for. Omnigraffle is a hugely powerful program, and once you&#8217;ve mastered its (intuitive) interface you&#8217;ll be mocking up interfaces in no time at all.</p>
<p>Perhaps even more important - through Omnigraffle&#8217;s excellent multiselection tools it is very easy to manipulate an existing mockup, enabling to try out different layouts as quickly as you can think them.</p>
<p>[[posterous-content:fFmvdEpJJvEAzgtuaqjc]]</p>
<p>Omnigraffle is based around the concept of stencils, which work a bit like LEGO bricks; there are lots of different pre-made parts (like for instance the various parts of the iOS UI) which you can import into your diagram, letting you quickly scaffold your prototype.</p>
<p>And of course it is also easy draw free-hand objects, when there isn&#8217;t a stencil within immediate reach that suits your needs.</p>
<p>An indirect negative note: Omnigraffle sells itself also as a flowchart maker, and I&#8217;ve seen examples of mindmaps done with it, too. In both of these fields, however, Omnigraffle really cannot compete with neither iThoughts nor Instaviz.</p>
<p>But, when it comes to prototyping, it really is a beast, and in my mind the rich feature list and easy of use justifies the hefty price tag.&nbsp;</p>
<h2>Doodling with Drawing Pad</h2>
<p>Charts and mindmaps and UML and OOAD and software engineering in all its glory - sometimes you just need to doodle! When overcome by that urge, our favourite tool is Drawing Pad. Super-easy to use, yet still surprisingly powerful.</p>
<p>[[posterous-content:eclHEIxxtJFFcpaabjnw]]</p>
<p>There are several more professional drawing apps out there, but for us that kind of misses the mark - our doodle needs are, per definition, basic and immediate, and thus we need a basic and immediate app to fulfill them. Paint instead of Photoshop, so to say. Drawing Pad fits this role perfectly</p>
<h2>Coding and code-reviewing with Textastic</h2>
<p>As initially stated, we first sketch and doodle and map on the iPad, and then move on to coding on our MacBooks. Sometimes, however, you&#8217;ll want to hack down some code while doodling, or maybe quickly read/review some existing code in order to know how to proceed with the current flowchart. Then it is convenient to have the possibility to do so directly on the iPad, and not having to change devices.</p>
<p>[[posterous-content:qsuzytFFFvfIzdklEvke]]</p>
<p>When this happens, we turn to Textastic. Expensive in comparison to its competitors, but again, you get what you pay for. A very nice interface and excellent Dropbox support has won us over.&nbsp;</p>
<p>But, isn&#8217;t coding on the iPad rather cumbersome? Yes, definitely, even if Textastic does what it can to easify the experience through extra characters on the keyboard, etc. But the point isn&#8217;t to compete with coding on the computer (which it could never do), but to provide an ok experience when some instant coding needs to be done in connection with some doodling in the other apps.&nbsp;</p>
<p>And, as stated above, we frequently find ourselves wanting to read some specific code while planning, and to this end Textastic works perfectly.</p>
<h2>File sharing with Dropbox</h2>
<p>Ok, so focus was on the design process, but now I&#8217;ve mentioned Dropbox too many times not to give it its own headline. Dropbox is a brilliant tool for sharing files, and especially well suited for the development flow consisting of all of the above mentioned apps.&nbsp;</p>
<p>[[posterous-content:AlybBJvyCIIkbCrJrfzF]]</p>
<p>We&#8217;ll make a Dropbox folder for our project, and then from the other productivity apps we&#8217;ll export the result to that folder. For the apps that don&#8217;t support Dropbox (like Instaviz) we export a photo, which we can then put into the folder using the Dropbox app.</p>
<h2>What we&#8217;re still missing</h2>
<p>Perhaps it doesn&#8217;t sort directly under the desing flow headline, but we still haven&#8217;t managed to settle for a project management / todo list application. This definitely impedes us, especially since neither me nor my brother are the most organised people to begin with. So, if you guys out there have any favourites, please try to sell us on them!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/titanium-application-structure-learning-from/">Titanium Application Structure – Learning From Tweetanium</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-16T00:00:00+01:00" pubdate data-updated="true">Feb 16<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">Struct - learning from Tweetanium regarding application structure best practices!</div>
<p>Up until recently, like so many other lost souls, we&#8217;ve followed the same Titanium application structure as Appcelerator&#8217;s KitchenSink application. In this paradigm, when you want to open a new window, you&#8217;d typically do something like this:</p>
<script src="https://gist.github.com/829615.js?file=openingwindow.js"></script>
<p>Inside somefile.js the window would be populated with controls, using the Ti.UI.currentWindow reference. We can access the data from the previous window through win.importantdata.</p>
<p>This approach, even when improved upon, has several disadvantages:</p>
<ul>
<li> If you have a file with application helper functions, you need to import that in every other file that needs the functionality. In my Tristania app for example, pretty much every file starts with Ti.include(&ldquo;../assets/utils.js&rdquo;).</li>
<li> Every time a window is meant to be created, the relevant file must be read and code parsed.</li>
<li>The structure of the app becomes rather opaque.</li>
<li>It is very difficult to unittest this approach.</li>
</ul>
<p>It all works, sure, but I&#8217;ve never been comfortable with my application structures, feeling there must be a better way. Even though there are (many) ways to improve on the above example, I wanted a different structure paradigm alltogether. Alas, I was too lazy to get around to experiment with it, so &ldquo;it remained but a beautiful thought&rdquo;, as we say in Sweden.</p>
<p>Fortunately, <a href="http://twitter.com/kevinwhinnery">Kevin Whinnery</a>, <a href="http://twitter.com/chadauld">Chad Auld</a> and the rest of the Appcelerator team have no such character flaws! Recently they <a href="http://developer.appcelerator.com/blog/2011/01/tweetanium-source-code-release.html">opensourced Tweetanium</a>, a fully functioning Twitter client coded with best practices regarding both JavaScript in general and Titanium in particular.</p>
<p>Which was like christmas to me! The only non-Krawaller Titanium source code I&#8217;ve gleaned (with a few none-noteworthy exceptions) is the aforementioned KitchenSink, which &ndash; let&#8217;s be honest &ndash; is not a great piece of work at all. It demonstrates the API very well (which is great since the docs are crap), but as an application example, it leaves me wanting.</p>
<p>So, enter Tweetanium. As soon as you open up the sourcecode, it is evident that they&#8217;re doing things very differently! I have created a stripped-down, barebones version of it called Struct, aiming to expose the new structure paradigm. You&#8217;ll find the git repo <a href="https://github.com/krawaller/struct">here</a>. This is what it looks like &ndash; isn&#8217;t knowledge beautiful? :)</p>
<p>[[posterous-content:GjClsyjFxfyzfhrEvEFH]]</p>
<p>The main point in the Tweetanium approach is that my various files (like somefile.js in the above example) are not messing with Ti.UI.currentWindow &ndash; instead, it augments a global namespace with a constructor variable. In Struct, I end up with the following global object:</p>
<script src="https://gist.github.com/829615.js?file=globalobject.js"></script>
<p>The program flow is that the otherwise pretty empty app.js imports struct.js, which can be considered your main app definition file. This file creates the global namespace and maybe some utility functions, and then includes the other files to populate the rest of the namespace.</p>
<p>This means that as soon as the struct.js file is included, the entire app structure is created in memory. No more parsing of files will be done during the session.</p>
<p>App.js will then call the createApplicationWindow function, call the open method on the returned window, and maybe do some other app initialization stuff. Now the app is up and running! In Struct, app.js looks like this:</p>
<script src="https://gist.github.com/829615.js?file=app.js"></script>
<p>So what are the great advantages to this approach? I&#8217;ve already found quite a few, but it boils down to a single keyword: closure. Every single function is executed in the same closure (ok, maybe subclosures, but you get the gist). Read that sentence again until the implications set in.</p>
<p>This is good news from a performance perspective (and most likely stability) &ndash; no more importing the same file a gazillion times! But from an infrastructure point of view its even yummier:</p>
<ul>
<li> As we always have access to the same scope, we can keep app-wide data in a single object, instead of JSON:ing back and forth with Ti.App.Properties. </li>
<li> All kinds of other convenience 	structures are suddenly very easy to build. In Struct there is a global messaging system, using one single view, instantiated only once. Tweetanium does a similar thing with a loader view, and has a 	very neat Model baseclass thing going. </li>
<li> You can instantiate all app windows and views immediately, as they all live in the same closure. Windows opened at a later point will also live in the same closure, since that&#8217;s where the constructor function is defined. </li>
<li> Creating your own navigation system (&#8220;immersive UI&#8221;, to use Apple&#8217;s lingo) is a breeze. In Struct I&#8217;ve stolen the home-brewed tabs from Tweetanium. </li>
</ul>
<p>Now, having autopsied Tweetanium, created Struct and looking at the layout before me, it seems very obvious and self-evident. Perhaps it already was to the rest of you, but for me it was a new-found revelation, and I can&#8217;t wait to test it out in our next project! So, for those of you who like me hadn&#8217;t caught on to this train before, check out <a href="https://github.com/krawaller/struct">Struct</a> &amp; <a href="http://developer.appcelerator.com/blog/2011/01/tweetanium-mobile.html">Tweetanium</a> and try it out!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/releasing-auktionera-a-tradera-iphone-app/">Releasing Auktionera, a Tradera iPhone App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-03T00:00:00+01:00" pubdate data-updated="true">Feb 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">Releasing Auktionera, our iPhone app for the Swedish auction site Tradera!</div>
<p style="padding-left: 30px;"><strong>Update</strong>: As Tradera finally saw sense and ported the eBay app, we&#8217;re pulling the Auktionera app from the App Store! One has to choose one&#8217;s battles&#8230;&nbsp;</p>
<p>As Jacob wrote the Livetanium post 2 months ago, I remember us vowing to keep up the pace in the content flow to this blog. That was, as stated, two months ago, and this place has been tumbleweeding ever since. Epic fail, as the kids (<a href="http://thebestpageintheuniverse.net/c.cgi?u=epic" target="_blank">erroneously</a>) say these days!&nbsp;</p>
<p>One of our excuses is a pretty intense development of an iPhone app for the swedish auction site Tradera, which is now released to the App Store! <a href="http://itunes.apple.com/se/app/id416520953">Here</a>&#8217;s a shop link, and we also created a little <a href="http://auktionera-app.se" title="Auktionera app support site" target="_blank">support site</a> with some more information (in Swedish).</p>
<h3>Functionality</h3>
<p>The app is a pretty standard auction site app, much like the eBay one. You can peruse auctions, bid, create your own auctions, save favourite searhes / users / auctions, check seller history, etc.</p>
<p>[[posterous-content:ItBjeFqdGnhGEbvbsdwz]]</p>
<p>Made with love and care, but pretty boring, in other words. This was also our approach as we entered the project. We weren&#8217;t&nbsp;really intrigued by the technical challenges, but&nbsp;thought this had a good chance of selling well. This mainly because there <a href="http://itunes.apple.com/us/app/id363997028?mt=8" title="The competition!" target="_blank">already was an app in the store</a>, selling better than our Systemet in spite of being rather crap.&nbsp;</p>
<p>This competing app is getting flak because of two different things:</p>
<ul>
<li>It is, as stated, rather crappy, being very prone to crash. Also some functions have ceased to work after the latest iOS upgrades.&nbsp;</li>
<li>It relies completely on <a href="http://api.tradera.com/" title="Tradera API" target="_blank">Tradera&#8217;s official API</a>, which for whatever reason is missing some vital functionality, such as checking out a seller&#8217;s previous history. This is, naturally, something that an auctioneer want to be able to do, before taking the plunge and risking those hard-earned dimes!</li>
</ul>
<p>Our tactic was therefore a mirror image of this list:</p>
<ul>
<li>Make sure the app doesn&#8217;t crash and burn!</li>
<li>Complement the official API functionality with some YQL scraping on the side.</li>
</ul>
<p>Sounded easy enough, but it turned out that none of the above was as straight-forward as we thought..</p>
<h3>Titanium stability</h3>
<p>After a lengthy development cycle in Titanium and the emulator, we did a first reality test on an actual device. We weren&#8217;t really worried, as the app flowed very neatly in the emulator. But, as we fired it up on the phone, we discovered to our dismay that we had managed to copy the very fickleness we wanted to avoid! The app would crash in random places, not leaving any definite clues as to why.&nbsp;</p>
<p>Not until we ran the app in an emulator next to the activity monitor did we find out why. It turned out that Titanium did some things rather inefficiently, which would eventually cause the phone to run out of memory or processor juice. The same thing happened in the emulator, but there it wouldn&#8217;t hit the ceiling as soon, as the computer has much more resources.&nbsp;</p>
<p>So, what were these inefficient things that Titanium did? Well:</p>
<ul>
<li>First off - <strong>don&#8217;t handle XML</strong> in your app, unless you can avoid it. XML is of course painful in and of itself, but Titanium&#8217;s garbage collection somehow cannot clean up after xml parsing. Try it: open a new window, parse some XML, then close that window (using the back button, for example), and watch the processor usage spike, never to drop again.&nbsp;</li>
<li>Be careful when doing <strong>advanced table creation</strong>. Use the best practices detailed in the <a href="http://assets.appcelerator.com.s3.amazonaws.com/docs/API_UITableViewClass.pdf" target="_blank">documentation</a>, and test your table generation with the Activity indicator running. For some combinations of table gymnastics, the memory usage will be intolerably high, eventually making the app crash.</li>
<li>If you have a large data structure, <strong>prefer a sqlite database</strong> to just keeping a big object in memory. This might be obvious to the rest of the world, but took us a bit off guard - intuitively, we thought it would be more efficient to keep a single object and query that, skipping the overhead cost of a database. However, some testing proved us very wrong indeed - the sqlite database is quicker and uses far less memory.</li>
</ul>
<p>So we learned some specifics, but the main lesson for us was this: do <strong>frequent reality checks</strong> on an actual device. Titanium is still a young framework with many rough edges, and some of those edges will not cut you in the emulator since that does not correctly emulate the hardware limitations.&nbsp;</p>
<h3>YQL + Tradera = somewhat true</h3>
<p>We also had a rough time with the intermingling of official functionality and our home-brewed YQL-fueled queries. There were several authentication and authorization models involved; the Tradera API requires an App-Id, the user must be authenticated through the API, and also through the official site for our scraping to work.&nbsp;</p>
<p>When starting off, we had all this in a spaghetti-bowl of code in the app. Lots of moving parts, lots of things that could break at any time. Not until we isolated all of this to a PHP-bridge did the different parts fall into place. This is of course what we should have done from the beginning - separations of concern is something we frequently preach to others. But somehow we fooled ourselves into thinking we&#8217;d already done this, as we has lots of logic in the YQL OpenTables. The lesson: you can always abstract your code one step further. :)</p>
<h3>API design IS an artform</h3>
<p>The biggest challenge, however, was actually using the Tradera API. I now realize that I&#8217;ve taken usability and intuitivity for granted in the API:s that I use, not thinking much of it. It&#8217;s like appreciating your mom doing all the household chores - you don&#8217;t, until you move out. I had no idea that designing a good API takes work, until I used a bad one.</p>
<p>Now, you shouldn&#8217;t bite the hand that feeds you, but the Tradera API is pretty horrid. There seems to be no general rule for naming functions (camel casing, lower case, it&#8217;s the wild west in there). The same property names mean different things in different functions. Documented properties are sometimes populated, sometimes not, depending on the weather and alignent of planets. Functionality between functions overlap, but never so much that you can ignore one function and just use the other.</p>
<p>And, most jarringly - there are several spelling errors in the API! When first creating our infrastructure to make calls, I tested it using the most simple function &#8220;GetOfficialTime&#8221;, requiring no parameters and just returning a flat data object. It didn&#8217;t work. Several hours later of reading SOAP specs and going through the code, I found the error - I needed to spell it &#8220;GetOfficalTime&#8221;, note the missing &#8220;i&#8221;. Fast forward a few weeks, and the same thing happened again when we tried to filter out used goods with the search parameter &#8220;ItemCondition&#8221;. It was supposed to be &#8220;ItemConditon&#8221;, again note the missing &#8220;i&#8221;.&nbsp;</p>
<p>In Tradera&#8217;s&nbsp;defense, the misspellings are also present in the documentation, and they offer free support for developers using the API, which we found very helpful. But still, it made me better at appreciate good API design. And more on my guard when using them.</p>
<h3>The result</h3>
<p>In the end we feel pretty proud of the result! This in spite of entering the project with little heart, and being in some serious stability trouble mid-journey. So, now to the boring side of things - pushing the app, spreading the word. As previously lamented, this is not what we do best.</p>
<p>Anyhow, hope the Swedish speakers among you will check the app out! Next up, Jacob will do a (less chatty) write-up on his neat method for deploying app builds to testers, right, brother? The pressure is on!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/krablog/livetanium/">Livetanium</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-01T00:00:00+01:00" pubdate data-updated="true">Dec 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="summarytext">Our latest experiment, Livetanium, lets you do realtime prototyping when creating Titanium apps. For the lowdown on why this is a good idea, check out this article!</div>
<p>We&#8217;re proud to announce our latest experiment - <strong>Livetanium</strong> - realtime prototyping for Titanium Mobile.</p>
<p><a href="http://krawaller.se/livetanium.swf" title="Livetanium walkthrough"><img src="http://posterous.com/getfile/files.posterous.com/temp-2010-12-01/jxHAyfibaCbprllDiquvjCDDHaesbhztwicqqcesrgtDbgEBkEbuEIyuFyBi/livetanium.jpg.scaled500.jpg" height="313" alt="" width="500" /></a></p>
<p>Made out of titanium, nodejs and unicorns, our Livetanium library lets you code Titanium Mobile apps and see changes in realtime. It uses a nodejs server to pipe filechanges to the app, and these changes are applied in realtime. It&#8217;s iPhone only at the moment, but works in both the simulator and on the actual device. You can <a href="http://krawaller.se/livetanium.swf" title="Livetanium walkthrough">see a quick walkthrough here </a>or check out <a href="https://github.com/krawaller/Titanium-Tools/tree/master/Resources/tools/livetanium/" title="Livetanium source code">the source</a>.</p>
<p>Please try it out and let us know what you think!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/krablog/blog/page/2/">&larr; Older</a>
    
    <a href="/krablog/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/krablog/testing-backbone-objects/">Testing Backbone Objects</a>
      </li>
    
      <li class="post">
        <a href="/krablog/slides-form-sfis-talk-october-2012/">Slides form SFIS talk October 2012</a>
      </li>
    
      <li class="post">
        <a href="/krablog/software-passion/">Software Passion</a>
      </li>
    
      <li class="post">
        <a href="/krablog/coffeescript-overview-and-resource-inventory/">CoffeeScript overview and resource inventory</a>
      </li>
    
      <li class="post">
        <a href="/krablog/krawaller-real-life-appearances/">Krawaller real-life appearances</a>
      </li>
    
  </ul>
</section>
<section>
	<h1>Tag Cloud</h1>
	<span id="tag-cloud"><a href='/krablog//krablogblog/categories/android' style='font-size: 105.0%'>android</a> <a href='/krablog//krablogblog/categories/auktionera' style='font-size: 105.0%'>auktionera</a> <a href='/krablog//krablogblog/categories/backbone' style='font-size: 105.0%'>Backbone</a> <a href='/krablog//krablogblog/categories/couchone' style='font-size: 105.0%'>couchone</a> <a href='/krablog//krablogblog/categories/development' style='font-size: 160.0%'>development</a> <a href='/krablog//krablogblog/categories/github' style='font-size: 110.0%'>github</a> <a href='/krablog//krablogblog/categories/golingo' style='font-size: 115.0%'>golingo</a> <a href='/krablog//krablogblog/categories/instaviz' style='font-size: 105.0%'>instaviz</a> <a href='/krablog//krablogblog/categories/ipad' style='font-size: 105.0%'>ipad</a> <a href='/krablog//krablogblog/categories/iphone' style='font-size: 105.0%'>iphone</a> <a href='/krablog//krablogblog/categories/ithoughts' style='font-size: 105.0%'>ithoughts</a> <a href='/krablog//krablogblog/categories/jasmine' style='font-size: 105.0%'>Jasmine</a> <a href='/krablog//krablogblog/categories/labyrinth' style='font-size: 115.0%'>labyrinth</a> <a href='/krablog//krablogblog/categories/livetanium' style='font-size: 105.0%'>livetanium</a> <a href='/krablog//krablogblog/categories/nodejs' style='font-size: 105.0%'>nodejs</a> <a href='/krablog//krablogblog/categories/omnigraffle' style='font-size: 105.0%'>omnigraffle</a> <a href='/krablog//krablogblog/categories/release' style='font-size: 130.0%'>release</a> <a href='/krablog//krablogblog/categories/review' style='font-size: 125.0%'>review</a> <a href='/krablog//krablogblog/categories/ria-university-course' style='font-size: 110.0%'>RIA_university_course</a> <a href='/krablog//krablogblog/categories/sinon' style='font-size: 105.0%'>Sinon</a> <a href='/krablog//krablogblog/categories/smartphone-webapp' style='font-size: 145.0%'>smartphone_webapp</a> <a href='/krablog//krablogblog/categories/struct' style='font-size: 105.0%'>struct</a> <a href='/krablog//krablogblog/categories/systemet' style='font-size: 105.0%'>systemet</a> <a href='/krablog//krablogblog/categories/testing' style='font-size: 105.0%'>Testing</a> <a href='/krablog//krablogblog/categories/titanium' style='font-size: 135.0%'>titanium</a> <a href='/krablog//krablogblog/categories/tiview' style='font-size: 105.0%'>tiview</a> <a href='/krablog//krablogblog/categories/tradera' style='font-size: 105.0%'>tradera</a> <a href='/krablog//krablogblog/categories/tristania' style='font-size: 110.0%'>tristania</a> <a href='/krablog//krablogblog/categories/tweetanium' style='font-size: 105.0%'>tweetanium</a> <a href='/krablog//krablogblog/categories/txtv' style='font-size: 105.0%'>txtv</a> <a href='/krablog//krablogblog/categories/yql' style='font-size: 115.0%'>yql</a> </span>
</section>
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("krawaller", 4, false);
    });
  </script>
  <script src="/krablog/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/krawaller" class="twitter-follow-button" data-show-count="false">Follow @krawaller</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Krawaller -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'krawaller';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
